<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo 4 | Gest√£o de Reservas</title>
    
    <style>
        /* ========================================================= */
        /* CSS: BARRA DE NAVEGA√á√ÉO (Adicionada) */
        /* ========================================================= */
        nav {
            background-color: #007bff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            /* Adicionado para fixar o menu no topo (Opcional, mas √∫til) */
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo {
            font-size: 1.5em;
            font-weight: bold;
        }
        .menu {
            display: flex;
            gap: 20px;
        }
        .menu a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            transition: text-decoration 0.3s;
        }
        .menu a:hover {
            text-decoration: underline;
        }
        
        /* ========================================================= */
        /* CSS: ESTILIZA√á√ÉO PADR√ÉO */
        /* ========================================================= */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #343a40;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative; 
        }
        h1 {
            color: #17a2b8; /* Cor turquesa/azul clara */
            border-bottom: 3px solid #17a2b8;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        h2 {
            color: #343a40;
            margin-top: 30px;
            border-left: 5px solid #ffc107;
            padding-left: 10px;
        }
        section {
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 25px;
            background-color: #ffffff;
        }
        /* Forms e Inputs */
        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 15px;
            border: 1px solid #17a2b833;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ced4da;
            box-sizing: border-box;
        }
        .full-row {
            grid-column: 1 / -1;
        }
        /* Bot√µes */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-right: 5px;
        }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-info:hover { background-color: #117a8b; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #1e7e34; }
        /* Tabela */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
            font-size: 0.9em;
        }
        th {
            background-color: #e9ecef;
            color: #495057;
        }
        /* Mensagens e Status */
        #messages {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .status-reserve { color: #17a2b8; font-weight: bold; }
        .status-loan { color: #007bff; font-weight: bold; }
        .notification-item {
            color: #dc3545;
            font-weight: bold;
            margin-top: 5px;
            padding: 5px 0;
            border-bottom: 1px dotted #e9ecef;
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">Biblioteca+ Solu√ß√µes</div>
        <div class="menu">
            <a href="index.html">index</a>
            <a href="Modulo1.html">Modulo 1</a>
            <a href="Modulo2.html">Modulo 2</a>
            <a href="Modulo3.html">Modulo 3</a>
            <a href="Modulo4.html">Modulo 4</a>
            <a href="Modulo5.html">Modulo 5</a>
        </div>
    </nav>
    
<div class="container">
    
    <h1>üìÖ M√≥dulo 4: Gest√£o de Reservas</h1>
    
    <p><strong>Descri√ß√£o da Funcionalidade: Reservas</strong></p>
    <ul>
        <li>Usu√°rios podem **reservar itens indispon√≠veis**.</li>
        <li>O sistema **notifica** quando o item √© devolvido e dispon√≠vel para retirada.</li>
    </ul>

    <div id="messages"></div>
    
    <section>
        <h2>üìù A√ß√µes de Reserva e Devolu√ß√£o</h2>
        <p>Simule uma reserva para um item **Emprestado** ou **Reservado** e depois simule a **Devolu√ß√£o** do mesmo item para acionar a notifica√ß√£o.</p>
        <form id="formAcao">
            <select id="selectUsuario" required>
                <option value="" disabled selected>Selecione o Usu√°rio (Matr√≠cula)</option>
            </select>
            <select id="selectAcervo" required>
                <option value="" disabled selected>Selecione o Item (ID do Acervo)</option>
            </select>
            
            <div class="full-row">
                <button type="button" class="btn-info" onclick="simularReserva()">Reservar Item</button>
                <button type="button" class="btn-success" onclick="simularDevolucao()">Devolver Item (Aciona Notifica√ß√£o)</button>
            </div>
        </form>
    </section>
    
    <section>
        <h2>üì¶ Status dos Itens e Reservas Ativas</h2>
        <table id="tabelaAcervos">
            <thead>
                <tr><th>ID</th><th>T√≠tulo</th><th>Tipo</th><th>Status Atual</th></tr>
            </thead>
            <tbody id="listaAcervosSimulada"></tbody>
        </table>
    </section>
    
    <section>
        <h2>üö® Notifica√ß√µes de Reserva Dispon√≠vel</h2>
        <ul id="listaNotificacoes">
            <li class="notification-item" style="color:#17a2b8;">(Notifica√ß√µes de reserva aparecer√£o aqui ap√≥s uma devolu√ß√£o de um item reservado.)</li>
        </ul>
    </section>

</div>

<script>
    // =========================================================
    // JAVASCRIPT: L√ìGICA DO M√ìDULO 4 (RESERVAS)
    // =========================================================
    
    let movimentacoes = []; // Armazena Reservas e Empr√©stimos (Simulados)
    let acervos = [];
    let usuarios = [];
    let nextMovimentacaoId = 2000;

    // --- Dados Auxiliares (Simula√ß√£o) ---
    function setupInitialData() {
        // Itens de Acervo
        acervos = [
            { id: 1, titulo: "1984", tipo: "Livro", status: "Dispon√≠vel" },
            { id: 2, titulo: "Laptop Dell", tipo: "Eletr√¥nico", status: "Emprestado" }, // Indispon√≠vel para teste
            { id: 3, titulo: "National Geographic", tipo: "Revista", status: "Dispon√≠vel" },
            { id: 4, titulo: "Tablet Samsung", tipo: "Eletr√¥nico", status: "Reservado" }, // Indispon√≠vel para teste
        ];
        // Usu√°rios
        usuarios = [
            { id: 101, nome: "Ana Silva", matricula: "2023001", suspenso: false },
            { id: 102, nome: "Prof. Carlos", matricula: "DOC010", suspenso: false },
        ];
        // Movimenta√ß√µes (Simula√ß√£o de itens j√° em uso)
        movimentacoes = [
            { id: 1001, usuarioMat: "2023001", acervoId: 2, tipoItem: "Eletr√¥nico", acao: "Empr√©stimo", status: "Ativo" },
            { id: 1002, usuarioMat: "DOC010", acervoId: 4, tipoItem: "Eletr√¥nico", acao: "Reserva", dataReserva: new Date().toLocaleDateString('pt-BR'), status: "Pendente" },
        ];
    }
    
    function loadData() {
        setupInitialData(); 
        
        // Popula os selects
        const selectUsuario = document.getElementById('selectUsuario');
        const selectAcervo = document.getElementById('selectAcervo');
        
        selectUsuario.innerHTML = '<option value="" disabled selected>Selecione o Usu√°rio (Matr√≠cula)</option>';
        usuarios.forEach(u => {
            selectUsuario.innerHTML += `<option value="${u.matricula}">${u.nome} (${u.matricula})</option>`;
        });

        selectAcervo.innerHTML = '<option value="" disabled selected>Selecione o Item (ID do Acervo)</option>';
        acervos.forEach(a => {
            selectAcervo.innerHTML += `<option value="${a.id}">${a.titulo} (ID: ${a.id}) - ${a.status}</option>`;
        });
        
        renderAcervosSimulada();
        // Limpa notifica√ß√µes ao recarregar
        document.getElementById('listaNotificacoes').innerHTML = '<li class="notification-item" style="color:#17a2b8;">(Notifica√ß√µes de reserva aparecer√£o aqui ap√≥s uma devolu√ß√£o de um item reservado.)</li>';
    }

    function displayMessage(text, type = 'info') {
        const msgDiv = document.getElementById('messages');
        let color, bg;
        if (type === 'success') { color = '#155724'; bg = '#d4edda'; }
        else if (type === 'error') { color = '#721c24'; bg = '#f8d7da'; }
        else { color = '#004085'; bg = '#cce5ff'; }
        
        msgDiv.style.display = 'block';
        msgDiv.style.color = color;
        msgDiv.style.backgroundColor = bg;
        msgDiv.textContent = text;
        
        setTimeout(() => { msgDiv.style.display = 'none'; }, 7000);
    }

    // A fun√ß√£o 'voltarAoInicio' foi removida. O carregamento de dados √© feito pelo loadData no in√≠cio.

    // --- L√ìGICA DE RESERVA ---

    window.simularReserva = function() {
        const matricula = document.getElementById('selectUsuario').value;
        const acervoId = parseInt(document.getElementById('selectAcervo').value);
        
        const usuario = usuarios.find(u => u.matricula === matricula);
        const acervo = acervos.find(a => a.id === acervoId);
        
        if (!usuario || !acervo) {
            displayMessage("Selecione um Usu√°rio e um Item v√°lidos.", 'error');
            return;
        }

        // 1. REQUISITO: Usu√°rios podem reservar itens INDISPON√çVEIS.
        if (acervo.status === "Dispon√≠vel") {
            displayMessage(`O item "${acervo.titulo}" j√° est√° dispon√≠vel. Fa√ßa o empr√©stimo, n√£o a reserva.`, 'error');
            return;
        }

        // 2. Checa se o usu√°rio j√° tem reserva ativa para este item (evitar duplicidade)
        const reservaExistente = movimentacoes.find(m => m.acervoId === acervoId && m.usuarioMat === matricula && m.acao === "Reserva" && m.status === "Pendente");
        if (reservaExistente) {
             displayMessage(`O usu√°rio ${usuario.nome} j√° possui uma reserva ativa para o item "${acervo.titulo}".`, 'error');
            return;
        }

        // 3. Efetiva a reserva
        movimentacoes.push({
            id: nextMovimentacaoId++,
            usuarioMat: usuario.matricula,
            acervoId: acervo.id,
            tipoItem: acervo.tipo,
            acao: "Reserva",
            dataReserva: new Date().toLocaleDateString('pt-BR'),
            status: "Pendente"
        });
        // Atualiza o status do item (se for a primeira reserva, ou mant√©m se j√° houver outras)
        if (acervo.status !== "Emprestado") acervo.status = "Reservado";

        displayMessage(`Reserva de "${acervo.titulo}" para ${usuario.nome} realizada. Aguardando devolu√ß√£o.`, 'info');
        loadData();
    }

    // --- L√ìGICA DE DEVOLU√á√ÉO (E NOTIFICA√á√ÉO) ---

    window.simularDevolucao = function() {
        const acervoId = parseInt(document.getElementById('selectAcervo').value);
        const acervo = acervos.find(a => a.id === acervoId);
        
        if (!acervo || (acervo.status === "Dispon√≠vel")) {
            displayMessage("Selecione um item indispon√≠vel (Emprestado ou Reservado) para simular a devolu√ß√£o.", 'error');
            return;
        }

        // 1. Marca o empr√©stimo ativo como conclu√≠do (se houver)
        const emprestimoAtivo = movimentacoes.find(m => m.acervoId === acervoId && m.acao === "Empr√©stimo" && m.status === "Ativo");
        if (emprestimoAtivo) {
             emprestimoAtivo.status = "Conclu√≠do";
        }
        
        // 2. Encontra a pr√≥xima reserva na fila (primeira pendente)
        const reservaPendente = movimentacoes
            .filter(m => m.acervoId === acervoId && m.acao === "Reserva" && m.status === "Pendente")
            .sort((a, b) => new Date(a.dataReserva) - new Date(b.dataReserva))[0]; // Pega a mais antiga
        
        const listaNotificacoes = document.getElementById('listaNotificacoes');
        
        if (reservaPendente) {
            // Se h√° reserva: Item vai para o pr√≥ximo usu√°rio e NOTIFICA
            acervo.status = "Reservado (Aguardando Retirada)";
            
            const usuarioReservado = usuarios.find(u => u.matricula === reservaPendente.usuarioMat);

            // REQUISITO: O sistema notifica quando o item √© devolvido
            listaNotificacoes.innerHTML += 
                `<li class="notification-item">üö® **NOTIFICA√á√ÉO:** O item "${acervo.titulo}" foi devolvido e est√° dispon√≠vel para retirada por **${usuarioReservado.nome}** (Mat.: ${reservaPendente.usuarioMat}).</li>`;
            
            // Simula a ativa√ß√£o da reserva, impedindo que outro a pegue
            reservaPendente.status = "Pronto para Retirada"; 
            
            displayMessage(`Item "${acervo.titulo}" devolvido. **Notifica√ß√£o enviada** ao reservista ${usuarioReservado.nome}.`, 'success');

        } else {
            // Se n√£o h√° reserva, o item volta a ficar dispon√≠vel
            acervo.status = "Dispon√≠vel";
            displayMessage(`Item "${acervo.titulo}" devolvido e dispon√≠vel novamente.`, 'success');
        }

        loadData(); 
    }
    
    // FUN√á√ÉO QUE REDESENHA A TABELA DE ITENS
    function renderAcervosSimulada() {
        const lista = document.getElementById('listaAcervosSimulada');
        lista.innerHTML = '';
        acervos.forEach(item => {
            const row = lista.insertRow();
            row.insertCell().textContent = item.id;
            row.insertCell().textContent = item.titulo;
            row.insertCell().textContent = item.tipo;
            row.insertCell().textContent = item.status;
        });
    }

    // Inicializa√ß√£o
    window.onload = loadData;

</script>

</body>
</html>